<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Interfaz Web ↔ WinForms</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
        }

        #mensajes {
            border: 1px solid #ccc;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>

    <h2>Enlace Web ↔ WinForms vía RabbitMQ</h2>
    <input type="text" id="mensaje" placeholder="Mensaje para la app de escritorio">
    <button onclick="enviarMensaje()">Enviar a WinForms</button>

    <h3>Mensajes recibidos desde WinForms:</h3>
    <div id="mensajes"></div>

    <script>
        async function enviarMensaje() {
            const mensaje = document.getElementById("mensaje").value;
            if (!mensaje.trim()) return;

            await fetch("/api/message/to-app", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(mensaje)
            });

            document.getElementById("mensaje").value = "";
        }

        async function recibirMensaje() {
            const res = await fetch("/api/message/from-app");
            const texto = await res.text();
            if (texto) {
                const div = document.createElement("div");
                div.textContent = texto;
                document.getElementById("mensajes").appendChild(div);
            }
        }

        setInterval(recibirMensaje, 2000);
    </script>

</body>
</html>
